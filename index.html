<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WeStream_Anime</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #121212;
    color: #eee;
    margin: 0;
    display: flex;
    height: 100vh;
  }
  nav {
    width: 300px;
    background: #1f1f1f;
    padding: 20px;
    overflow-y: auto;
    border-right: 2px solid #333;
  }
  nav h2 {
    margin-top: 0;
  }
  ul {
    list-style: none;
    padding-left: 0;
  }
  li {
    cursor: pointer;
    padding: 8px 12px;
    border-radius: 6px;
    margin-bottom: 6px;
    background-color: #292929;
    user-select: none;
  }
  li:hover {
    background-color: #3a3a3a;
  }
  li.active {
    background-color: #4a90e2;
    font-weight: bold;
    color: white;
  }
  button.remove-btn {
    background: #e74c3c;
    border: none;
    color: white;
    padding: 2px 6px;
    font-size: 0.8rem;
    border-radius: 4px;
    cursor: pointer;
    float: right;
  }
  main {
    flex: 1;
    padding: 30px;
    background: #181818;
    display: flex;
    flex-direction: column;
  }
  h1 {
    margin-top: 0;
    margin-bottom: 20px;
  }
  #listContainer > ul {
    margin: 0 0 20px 0;
    padding-left: 0;
  }
  button.episode-btn {
    padding: 8px 15px;
    margin-right: 10px;
    margin-bottom: 10px;
    border: none;
    border-radius: 6px;
    background: #292929;
    color: #eee;
    cursor: pointer;
    font-size: 1rem;
  }
  button.episode-btn.active {
    background: #4a90e2;
    font-weight: bold;
  }
  button.episode-btn:hover {
    background: #444;
  }
  video {
    width: 100%;
    max-height: 70vh;
    background: black;
    border-radius: 8px;
    outline: none;
  }
  form {
    margin-bottom: 20px;
    background: #292929;
    padding: 15px 20px;
    border-radius: 8px;
  }
  form label {
    display: block;
    margin-bottom: 6px;
  }
  form input {
    width: 100%;
    padding: 8px;
    margin-bottom: 12px;
    border-radius: 5px;
    border: none;
    font-size: 1rem;
  }
  form button {
    background: #4a90e2;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 6px;
    cursor: pointer;
  }
  form button:hover {
    background: #357abd;
  }
</style>
</head>
<body>

<nav>
  <h2>Gestion des Animes</h2>
  <ul id="animeList"></ul>

  <form id="addAnimeForm">
    <h3>Ajouter un Anime</h3>
    <label for="animeTitleInput">Titre Anime</label>
    <input type="text" id="animeTitleInput" required placeholder="Titre de l'anime" />
    <button type="submit">Ajouter Anime</button>
  </form>

  <form id="addSeasonForm" style="display:none;">
    <h3>Ajouter une Saison</h3>
    <label for="seasonNumInput">Numéro Saison</label>
    <input type="number" id="seasonNumInput" min="1" required />
    <button type="submit">Ajouter Saison</button>
  </form>

  <form id="addEpisodeForm" style="display:none;">
    <h3>Ajouter un Épisode</h3>
    <label for="episodeNumInput">Numéro Épisode</label>
    <input type="number" id="episodeNumInput" min="1" required />
    <label for="episodeUrlInput">URL vidéo (MP4)</label>
    <input type="url" id="episodeUrlInput" required placeholder="https://..." />
    <button type="submit">Ajouter Épisode</button>
  </form>
</nav>

<main>
  <h1 id="animeTitle">Sélectionne un anime</h1>
  <div id="listContainer"></div>
  <video id="videoPlayer" controls>
    <source src="" type="video/mp4" />
    Ton navigateur ne supporte pas la lecture vidéo.
  </video>
</main>

<script>
  let animes = [];
  let selectedAnime = null;
  let selectedSeason = null;
  let selectedEpisode = null;

  const animeListEl = document.getElementById('animeList');
  const animeTitleEl = document.getElementById('animeTitle');
  const listContainer = document.getElementById('listContainer');
  const videoPlayer = document.getElementById('videoPlayer');

  const addAnimeForm = document.getElementById('addAnimeForm');
  const addSeasonForm = document.getElementById('addSeasonForm');
  const addEpisodeForm = document.getElementById('addEpisodeForm');

  function saveData() {
    localStorage.setItem('animesData', JSON.stringify(animes));
  }

  function loadData() {
    const data = localStorage.getItem('animesData');
    if (data) animes = JSON.parse(data);
  }

  function renderAnimeList() {
    animeListEl.innerHTML = '';
    animes.forEach((anime, i) => {
      const li = document.createElement('li');
      li.textContent = anime.title;
      if (selectedAnime === anime) li.classList.add('active');

      const btnDel = document.createElement('button');
      btnDel.textContent = 'X';
      btnDel.className = 'remove-btn';
      btnDel.title = "Supprimer cet anime";
      btnDel.onclick = (e) => {
        e.stopPropagation();
        if (confirm(`Supprimer "${anime.title}" ?`)) {
          if(selectedAnime === anime) {
            selectedAnime = null;
            selectedSeason = null;
            selectedEpisode = null;
            clearMain();
            updateForms();
          }
          animes.splice(i, 1);
          saveData();
          renderAnimeList();
          renderListContainer();
        }
      };
      li.appendChild(btnDel);

      li.onclick = () => {
        selectedAnime = anime;
        selectedSeason = null;
        selectedEpisode = null;
        renderAnimeList();
        renderListContainer();
        updateForms();
        animeTitleEl.textContent = `Anime: ${anime.title} — Sélectionne une saison`;
        videoPlayer.src = '';
      };

      animeListEl.appendChild(li);
    });
  }

  function renderListContainer() {
    listContainer.innerHTML = '';

    if (!selectedAnime) {
      listContainer.textContent = 'Sélectionne un anime.';
      return;
    }

    // Affiche les saisons pour l'anime sélectionné
    if (selectedSeason === null) {
      if (selectedAnime.seasons.length === 0) {
        listContainer.textContent = 'Aucune saison. Ajoute une saison.';
        return;
      }
      const ul = document.createElement('ul');
      selectedAnime.seasons.forEach((season) => {
        const li = document.createElement('li');
        li.textContent = `Saison ${season.seasonNum}`;
        if (selectedSeason === season) li.classList.add('active');

        const btnDel = document.createElement('button');
        btnDel.textContent = 'X';
        btnDel.className = 'remove-btn';
        btnDel.title = "Supprimer cette saison";
        btnDel.onclick = (e) => {
          e.stopPropagation();
          if(confirm(`Supprimer la saison ${season.seasonNum} ?`)) {
            selectedAnime.seasons = selectedAnime.seasons.filter(s => s !== season);
            selectedSeason = null;
            selectedEpisode = null;
            saveData();
            renderListContainer();
            renderAnimeList();
            updateForms();
            videoPlayer.src = '';
            animeTitleEl.textContent = `Anime: ${selectedAnime.title} — Sélectionne une saison`;
          }
        }
        li.appendChild(btnDel);

        li.onclick = () => {
          selectedSeason = season;
          selectedEpisode = null;
          renderListContainer();
          updateForms();
          animeTitleEl.textContent = `${selectedAnime.title} — Saison ${season.seasonNum} — Sélectionne un épisode`;
          videoPlayer.src = '';
        };

        ul.appendChild(li);
      });
      listContainer.appendChild(ul);
      return;
    }

    // Affiche les épisodes pour la saison sélectionnée
    if (selectedSeason) {
      if (selectedSeason.episodes.length === 0) {
        listContainer.textContent = 'Aucun épisode. Ajoute un épisode.';
        return;
      }
      const div = document.createElement('div');
      selectedSeason.episodes.forEach((ep) => {
        const btn = document.createElement('button');
        btn.textContent = `Épisode ${ep.num}`;
        btn.className = 'episode-btn';
        if (selectedEpisode === ep) btn.classList.add('active');
        btn.onclick = () => {
          selectedEpisode = ep;
          playEpisode();
          renderListContainer();
          updateForms();
        };
        div.appendChild(btn);
      });
      listContainer.appendChild(div);
      return;
    }
  }

  function playEpisode() {
    if (!selectedEpisode) return;
    videoPlayer.src = selectedEpisode.url;
    videoPlayer.load();
    videoPlayer.play();
    animeTitleEl.textContent = `${selectedAnime.title} — Saison ${selectedSeason.seasonNum} — Épisode ${selectedEpisode.num}`;
  }

  function clearMain() {
    animeTitleEl.textContent = 'Sélectionne un anime';
    listContainer.innerHTML = '';
    videoPlayer.src = '';
  }

  function updateForms() {
    addSeasonForm.style.display = selectedAnime ? 'block' : 'none';
    addEpisodeForm.style.display = (selectedAnime && selectedSeason) ? 'block' : 'none';
  }

  addAnimeForm.onsubmit = (e) => {
    e.preventDefault();
    const title = document.getElementById('animeTitleInput').value.trim();
    if (!title) return alert('Titre anime requis');
    if(animes.find(a => a.title.toLowerCase() === title.toLowerCase())) {
      return alert("Cet anime existe déjà.");
    }
    animes.push({ title, seasons: [] });
    saveData();
    renderAnimeList();
    addAnimeForm.reset();
  };

  addSeasonForm.onsubmit = (e) => {
    e.preventDefault();
    const num = parseInt(document.getElementById('seasonNumInput').value);
    if (!num || num < 1) return alert('Numéro saison invalide');
    if (selectedAnime.seasons.find(s => s.seasonNum === num)) {
      return alert(`La saison ${num} existe déjà.`);
    }
    selectedAnime.seasons.push({ seasonNum: num, episodes: [] });
    saveData();
    renderListContainer();
    renderAnimeList();
    addSeasonForm.reset();
  };

  addEpisodeForm.onsubmit = (e) => {
    e.preventDefault();
    const num = parseInt(document.getElementById('episodeNumInput').value);
    const url = document.getElementById('episodeUrlInput').value.trim();
    if (!num || num < 1) return alert('Numéro épisode invalide');
    if (!url.endsWith('.mp4')) return alert('URL MP4 invalide');
    if (selectedSeason.episodes.find(ep => ep.num === num)) {
      return alert(`L'épisode ${num} existe déjà.`);
    }
    selectedSeason.episodes.push({ num, url });
    saveData();
    renderListContainer();
    addEpisodeForm.reset();
  };

  loadData();
  renderAnimeList();
  updateForms();
</script>

</body>
</html>
